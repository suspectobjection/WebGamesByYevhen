<!-- Tycoon Mini Game: вставь этот блок в конец index.html перед </body> -->
<style>
  /* Tycoon styles */
  #tycoonWrap { position: fixed; right: 18px; bottom: 18px; width: 360px; max-width: 92vw; background: rgba(10,10,10,0.95); border: 1px solid rgba(255,255,255,0.04); padding: 12px; border-radius: 10px; color: #eee; font-family: "Segoe UI", Arial; z-index: 9999; box-shadow: 0 10px 30px rgba(0,0,0,0.6); }
  #tycoonHeader { display:flex; align-items:center; gap:8px; margin-bottom:8px; }
  #tycoonHeader h3 { margin:0; color:#00ffcc; font-size:16px; }
  #tycoonMain { display:flex; gap:10px; }
  #tycoonLeft { flex:1; display:flex; flex-direction:column; gap:8px; }
  #tycoonRight { width:140px; display:flex; flex-direction:column; gap:8px; }
  .tyCoin { font-size:20px; font-weight:800; color:#ffd166; }
  .tyBtn { background:#111; border:1px solid rgba(255,255,255,0.04); color:#fff; padding:8px; border-radius:8px; cursor:pointer; font-weight:700; }
  .tyBtn:disabled { opacity:0.45; cursor:not-allowed; }
  .upgrade { background:#0f0f0f; border-radius:8px; padding:8px; display:flex; justify-content:space-between; align-items:center; border:1px solid rgba(255,255,255,0.03); }
  .small { font-size:12px; color:#9aa0a6; }
  .leader { background:#0b0b0b; padding:8px; border-radius:8px; border:1px solid rgba(255,255,255,0.03); font-size:13px; }
  .tyFooter { margin-top:8px; display:flex; gap:8px; justify-content:space-between; align-items:center; }
  .closeTy { background:transparent; border:none; color:#888; cursor:pointer; font-size:14px; }
</style>

<div id="tycoonWrap" aria-live="polite">
  <div id="tycoonHeader">
    <h3>School Tycoon</h3>
    <div class="small">earn coins • buy upgrades</div>
    <button class="closeTy" id="tyClose" title="Hide">✕</button>
  </div>

  <div id="tycoonMain">
    <div id="tycoonLeft">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div>
          <div class="small">Coins</div>
          <div class="tyCoin" id="tyCoins">0</div>
        </div>
        <div style="text-align:right;">
          <div class="small">Per click</div>
          <div id="tyPerClick" style="font-weight:800;color:#fff">1</div>
        </div>
      </div>

      <button id="tyClick" class="tyBtn" style="font-size:18px;padding:12px;border-radius:10px;">Click to earn</button>

      <div style="margin-top:6px;">
        <div class="small">Upgrades</div>
        <div id="upgradesList" style="display:flex;flex-direction:column;gap:8px;margin-top:6px;"></div>
      </div>
    </div>

    <div id="tycoonRight">
      <div class="small">Auto income</div>
      <div id="tyAuto" style="font-weight:800;color:#ffd166">0 / min</div>

      <div style="margin-top:8px;">
        <div class="small">Leader board</div>
        <div id="tyLeaders" class="leader">No scores yet</div>
      </div>

      <div style="margin-top:auto;">
        <button id="tyReset" class="tyBtn" style="background:#3a0b0b">Reset</button>
      </div>
    </div>
  </div>

  <div class="tyFooter">
    <div class="small">Points saved locally</div>
    <div>
      <button id="tySaveScore" class="tyBtn" style="padding:6px 10px;font-size:13px">Save score</button>
    </div>
  </div>
</div>

<script>
(function(){
  // State
  const STORAGE_KEY = 'school_tycoon_v1';
  const LEAD_KEY = 'school_tycoon_leaders_v1';
  let state = {
    coins: 0,
    perClick: 1,
    autoPerMin: 0,
    upgrades: {
      clickBoost: { level:0, baseCost: 20, multiplier: 1.5 }, // increases perClick
      autoGen: { level:0, baseCost: 50, perMin: 1 } // increases autoPerMin
    }
  };

  // DOM
  const elCoins = document.getElementById('tyCoins');
  const elPerClick = document.getElementById('tyPerClick');
  const elClick = document.getElementById('tyClick');
  const elUpgrades = document.getElementById('upgradesList');
  const elAuto = document.getElementById('tyAuto');
  const elLeaders = document.getElementById('tyLeaders');
  const elReset = document.getElementById('tyReset');
  const elSave = document.getElementById('tySaveScore');
  const elClose = document.getElementById('tyClose');

  // Load
  function load(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(raw) state = JSON.parse(raw);
    }catch(e){}
  }
  function save(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  // Helpers
  function format(n){ return Math.floor(n).toLocaleString(); }
  function upgradeCost(base, level){ return Math.ceil(base * Math.pow(1.6, level)); }

  // Render
  function render(){
    elCoins.textContent = format(state.coins);
    elPerClick.textContent = format(state.perClick);
    elAuto.textContent = format(state.autoPerMin) + ' / min';

    // upgrades
    elUpgrades.innerHTML = '';
    // click boost
    const cb = state.upgrades.clickBoost;
    const cbCost = upgradeCost(cb.baseCost, cb.level);
    const cbDiv = document.createElement('div');
    cbDiv.className = 'upgrade';
    cbDiv.innerHTML = `<div><div style="font-weight:800">Click Boost</div><div class="small">Level ${cb.level} — +${(cb.level*1).toFixed(0)} per click</div></div>
      <div style="text-align:right"><div class="small">Cost</div><div style="font-weight:800">${format(cbCost)}</div><button class="tyBtn" data-up="clickBoost" style="margin-top:6px">Buy</button></div>`;
    elUpgrades.appendChild(cbDiv);

    // auto gen
    const ag = state.upgrades.autoGen;
    const agCost = upgradeCost(ag.baseCost, ag.level);
    const agDiv = document.createElement('div');
    agDiv.className = 'upgrade';
    agDiv.innerHTML = `<div><div style="font-weight:800">Auto Generator</div><div class="small">Level ${ag.level} — +${ag.level*ag.perMin} / min</div></div>
      <div style="text-align:right"><div class="small">Cost</div><div style="font-weight:800">${format(agCost)}</div><button class="tyBtn" data-up="autoGen" style="margin-top:6px">Buy</button></div>`;
    elUpgrades.appendChild(agDiv);

    // attach buy handlers
    elUpgrades.querySelectorAll('button[data-up]').forEach(btn=>{
      btn.onclick = ()=>{ buyUpgrade(btn.getAttribute('data-up')); };
    });

    // leaders
    renderLeaders();
    save();
  }

  // Buy upgrade
  function buyUpgrade(key){
    if(key === 'clickBoost'){
      const u = state.upgrades.clickBoost;
      const cost = upgradeCost(u.baseCost, u.level);
      if(state.coins < cost) return;
      state.coins -= cost;
      u.level += 1;
      // increase perClick: base 1 + level*1
      state.perClick = 1 + u.level * 1;
    } else if(key === 'autoGen'){
      const u = state.upgrades.autoGen;
      const cost = upgradeCost(u.baseCost, u.level);
      if(state.coins < cost) return;
      state.coins -= cost;
      u.level += 1;
      state.autoPerMin = u.level * u.perMin;
    }
    render();
  }

  // Click handler
  elClick.onclick = ()=>{
    state.coins += state.perClick;
    render();
  };

  // Auto income tick (every second, distribute per minute)
  setInterval(()=>{
    if(state.autoPerMin > 0){
      const perSec = state.autoPerMin / 60;
      state.coins += perSec;
      // avoid float drift by rounding occasionally
    }
    // update display frequently but not too heavy
    elCoins.textContent = format(state.coins);
  }, 1000);

  // Save score to local leaderboard
  function saveScore(){
    const name = prompt('Enter name for leaderboard (max 12 chars):','You');
    if(!name) return;
    const leaders = JSON.parse(localStorage.getItem(LEAD_KEY) || '[]');
    leaders.push({ name: name.slice(0,12), score: Math.floor(state.coins), time: Date.now() });
    // sort desc and keep top 10
    leaders.sort((a,b)=>b.score - a.score);
    localStorage.setItem(LEAD_KEY, JSON.stringify(leaders.slice(0,10)));
    renderLeaders();
    alert('Score saved locally.');
  }

  function renderLeaders(){
    const leaders = JSON.parse(localStorage.getItem(LEAD_KEY) || '[]');
    if(!leaders.length){ elLeaders.textContent = 'No scores yet'; return; }
    elLeaders.innerHTML = leaders.slice(0,5).map((l,i)=>`${i+1}. ${l.name} — ${l.score}`).join('<br>');
  }

  // Reset
  elReset.onclick = ()=>{
    if(!confirm('Reset your tycoon progress?')) return;
    state = { coins:0, perClick:1, autoPerMin:0, upgrades: { clickBoost:{level:0,baseCost:20,multiplier:1.5}, autoGen:{level:0,baseCost:50,perMin:1} } };
    save();
    render();
  };

  elSave.onclick = saveScore;
  elClose.onclick = ()=>{ document.getElementById('tycoonWrap').style.display = 'none'; };

  // init
  load();
  render();
})();
</script>
